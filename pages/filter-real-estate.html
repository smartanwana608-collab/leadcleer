<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Filter Real Estate Agents | CSV Automation Tools</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: system-ui, sans-serif;
  background: #f4f6f8;
  color: #1f2937;
}

header {
  background: #fff;
  padding: 22px;
  text-align: center;
  border-bottom: 1px solid #e5e7eb;
}

main {
  max-width: 1000px;
  margin: 40px auto;
  padding: 0 20px;
}

.card {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 14px;
  padding: 32px;
  margin-bottom: 30px;
}

.upload-box {
  border: 2px dashed #e5e7eb;
  border-radius: 12px;
  padding: 40px;
  text-align: center;
}

.file-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 16px;
  margin-top: 20px;
}

.info-item {
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 16px;
}

.btn {
  background: #2563eb;
  color: #fff;
  padding: 14px 26px;
  border-radius: 10px;
  border: none;
  font-weight: 600;
  opacity: 0.4;
  cursor: not-allowed;
}

.btn.enabled {
  opacity: 1;
  cursor: pointer;
}

.results {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 16px;
  margin-top: 20px;
}

.result-box {
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 20px;
  text-align: center;
}

.downloads {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 16px;
  margin-top: 30px;
}

.download-btn {
  background: #111827;
  color: #fff;
  padding: 14px;
  border-radius: 10px;
  border: none;
  font-weight: 600;
  opacity: 0.3;
  cursor: not-allowed;
}

.download-btn.enabled {
  opacity: 1;
  cursor: pointer;
}
</style>
</head>

<body>

<header>
  <h1>Filter Real Estate Agents</h1>
  <p>Upload a CSV and split real estate agents from other contacts</p>
</header>

<main>

<div class="card">
  <div class="upload-box">
    <input type="file" id="csvFile" accept=".csv" />
  </div>
</div>

<div class="card">
  <div class="file-info">
    <div class="info-item" id="fileName">File name: —</div>
    <div class="info-item" id="rowCount">Total rows: —</div>
    <div class="info-item" id="columnCount">Detected columns: —</div>
  </div>
</div>

<div class="card">
  <button id="analyzeBtn" class="btn">Analyze CSV</button>

  <div class="results">
    <div class="result-box">
      <strong id="agentCount">—</strong>
      Real Estate Agents
    </div>
    <div class="result-box">
      <strong id="otherCount">—</strong>
      Other Contacts
    </div>
  </div>

  <div class="downloads">
    <button id="downloadAgents" class="download-btn">
      Download Agents CSV
    </button>
    <button id="downloadOthers" class="download-btn">
      Download Other Contacts CSV
    </button>
  </div>
</div>

</main>

<script>
const fileInput = document.getElementById("csvFile");
const analyzeBtn = document.getElementById("analyzeBtn");

const fileNameEl = document.getElementById("fileName");
const rowCountEl = document.getElementById("rowCount");
const columnCountEl = document.getElementById("columnCount");

const agentCountEl = document.getElementById("agentCount");
const otherCountEl = document.getElementById("otherCount");

const downloadAgentsBtn = document.getElementById("downloadAgents");
const downloadOthersBtn = document.getElementById("downloadOthers");

let headers = [];
let agentRows = [];
let otherRows = [];

const keywords = ["realtor","realty","broker","kw","coldwell","century","sotheby"];

fileInput.addEventListener("change", () => {
  const file = fileInput.files[0];
  if (!file) return;

  fileNameEl.textContent = "File name: " + file.name;

  const reader = new FileReader();
  reader.onload = e => {
    const rows = e.target.result.trim().split("\n").map(r => r.split(","));
    headers = rows[0];
    const data = rows.slice(1);

    rowCountEl.textContent = "Total rows: " + data.length;
    columnCountEl.textContent = "Detected columns: " + headers.length;

    analyzeBtn.classList.add("enabled");

    analyzeBtn.onclick = () => {
      agentRows = [];
      otherRows = [];

      data.forEach(row => {
        const text = row.join(" ").toLowerCase();
        keywords.some(k => text.includes(k))
          ? agentRows.push(row)
          : otherRows.push(row);
      });

      agentCountEl.textContent = agentRows.length;
      otherCountEl.textContent = otherRows.length;

      downloadAgentsBtn.classList.add("enabled");
      downloadOthersBtn.classList.add("enabled");
    };
  };
  reader.readAsText(file);
});

function downloadCSV(filename, rows) {
  const csv = [headers, ...rows].map(r => r.join(",")).join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}

downloadAgentsBtn.onclick = () => {
  if (agentRows.length) downloadCSV("real_estate_agents.csv", agentRows);
};

downloadOthersBtn.onclick = () => {
  if (otherRows.length) downloadCSV("other_contacts.csv", otherRows);
};
</script>

</body>
</html>
